<app-header></app-header>
<h1 class="mat-display-1 center-align">Admin Page</h1>
<mat-tab-group>
  <mat-tab label="Add User">
    <form class="form-css" [formGroup]="addUserForm" #formDirective="ngForm" (ngSubmit)="addUser()">
      <mat-form-field class="full-width" hintLabel="Max 50 characters">
        <input #username matInput formControlName="firstName" type="text" placeholder="User first Name" required/>
        <mat-hint align="end">{{addUserForm.get('firstName').value?.length || 0}}/50</mat-hint>
        <mat-error *ngIf="addUserForm.get('firstName').invalid">{{getErrorMsg('firstName')}}</mat-error>
      </mat-form-field>
      <mat-form-field class="full-width" hintLabel="Max 45 characters">
        <input matInput formControlName="lastName" type="text" placeholder="User Last Name" required/>
        <mat-hint align="end">{{addUserForm.get('lastName').value?.length || 0}}/45</mat-hint>
        <mat-error *ngIf="addUserForm.get('lastName').invalid">{{getErrorMsg('lastName')}}</mat-error>
      </mat-form-field>
      <mat-form-field class="full-width" hintLabel="Select a department">
        <mat-select placeholder="Department" formControlName="department" required>
          <mat-option *ngFor="let dept of departments" [value]="dept">
            {{dept.departmentName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="full-width" hintLabel="Max 15 characters">
        <input matInput formControlName="username" type="text" placeholder="Username" required/>
        <mat-hint align="end">{{addUserForm.get('username').value?.length || 0}}/25</mat-hint>
        <mat-error *ngIf="addUserForm.get('username').invalid">{{getErrorMsg('username')}}</mat-error>
      </mat-form-field>
      <mat-form-field class="full-width">
        <input matInput formControlName="password" type="password" placeholder="User Password" required/>
        <mat-error *ngIf="addUserForm.hasError('required', 'password')">Password is required</mat-error>
      </mat-form-field>
      <mat-form-field class="full-width">
        <input matInput formControlName="confirmPassword" [errorStateMatcher]="matcher" type="password" placeholder="Confirm user password" required/>
        <mat-error *ngIf="addUserForm.hasError('notSame')">Passwords do not match</mat-error>
      </mat-form-field>
      <button type="submit" style="display:none" [disabled]="!addUserForm.valid"></button>
    </form>
    <button mat-raised-button (click)="addUser()" color="primary" [disabled]="!addUserForm.valid">Add User</button>
  </mat-tab>
  <mat-tab label="Remove User">
    <!-- TODO: lazy load table data -->
    <mat-form-field class="max-width">
      <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
    </mat-form-field>
    <button class="button-margin" mat-raised-button (click)="removeUsers()" color="primary" 
      [disabled]="selection.selected.length === 0">Remove User(s)</button>
    <button class="button-margin" mat-raised-button (click)="getUsers()">Reload Data</button>
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" matSort>
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="$event ? masterToggle() : null"
                          [checked]="selection.hasValue() && isAllSelected()"
                          [indeterminate]="selection.hasValue() && !isAllSelected()">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()"
                          (change)="$event ? selection.toggle(row) : null"
                          [checked]="selection.isSelected(row)">
            </mat-checkbox>
          </td>
        </ng-container>
        <!-- TODO: sorting on id does not work -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>User ID </th>
          <td mat-cell *matCellDef="let row"> {{row.userId}} </td>
        </ng-container>
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Username </th>
          <td mat-cell *matCellDef="let row"> {{row.username}} </td>
        </ng-container>
        <ng-container matColumnDef="firstName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>First Name</th>
            <td mat-cell *matCellDef="let element"> {{element.firstName}} </td>
          </ng-container>
          <ng-container matColumnDef="lastName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Name</th>
            <td mat-cell *matCellDef="let element"> {{element.lastName}} </td>
          </ng-container>
          <ng-container matColumnDef="department">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Department</th>
            <td mat-cell *matCellDef="let element"> {{element.department}} </td>
          </ng-container>
    
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;">
        </tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
    </div>
  </mat-tab>
  <mat-tab label="Change User Password"> Content 3 </mat-tab>
  <mat-tab label="Add Department">Form for adding department</mat-tab>
</mat-tab-group>
